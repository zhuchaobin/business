<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
	<title>无模版</title>
	<link rel="stylesheet" th:href="@{/resources/bootstrap/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/resources/dist/css/skins/_all-skins.css}"/>
	<link rel="stylesheet" th:href="@{/resources/dist/css/AdminLTE.min.css}"/>
	<link rel="stylesheet" th:href="@{/resources/dist/css/font-awesome.min.css}"/>
	<link rel="stylesheet" th:href="@{/resources/dist/css/ionicons.min.css}"/>
	<link rel="stylesheet" th:href="@{/resources/plugins/bootstrapValidator/bootstrapValidator.min.css}"/>
	<link rel="stylesheet" th:href="@{/resources/e7/css/e7-0.2.css}"/>
	<link rel="stylesheet" th:href="@{/resources/e7/e7table/e7table-0.2.css}"/>
	
	<link rel="stylesheet" th:href="@{/resources/css_zcb/common.css}" />
	<!-- 自定义按钮样式 -->
	<link rel="stylesheet" th:href="@{/resources/css_zcb/button.css}" />
</head>
<body>
<!-- Main content -->
<section id="sec_main" class="content">
	<!-- 条件查询 -->
	<div class="box box-info">
		<!-- 条件区域 -->
		<div class="box-body" style="padding-bottom:0px;">
			<form id="frm_query" class="form-horizontal">
				<div id="div_criteria" class="flowlayout">
																													<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">长约编号：</label>
									<div class="col-sm-8">
										<input name="arId" class="form-control" placeholder="长约编号" />
									</div>
								</div>
							</div>
																								<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">订单编号：</label>
									<div class="col-sm-8">
										<input name="ordrId" class="form-control" placeholder="订单编号" />
									</div>
								</div>
							</div>
																																			<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">银行名称：</label>
									<div class="col-sm-8">
										<input name="bnkNm" class="form-control" placeholder="银行名称" />
									</div>
								</div>
							</div>
																																			<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">品名：</label>
									<div class="col-sm-8">
										<input name="pdNm" class="form-control" placeholder="品名" />
									</div>
								</div>
							</div>
																								<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">规格：</label>
									<div class="col-sm-8">
										<input name="spec" class="form-control" placeholder="规格" />
									</div>
								</div>
							</div>
																																			<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">操作员：</label>
									<div class="col-sm-8">
										<input name="username" class="form-control" placeholder="操作员" />
									</div>
								</div>
							</div>
																																																									<div class="col-md-4">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">备注：</label>
									<div class="col-sm-8">
										<input name="rmrk" class="form-control" placeholder="备注" />
									</div>
								</div>
							</div>
															</div>
			</form>
		</div>

		<!-- 按钮区域 -->
		<div id="div_buttons" class="box-footer">
			<button class="btn btn-primary-red btn-sm" style="margin-right:5px;" onclick="javascript:showAddDialog();">添加</button>
			<button class="btn btn-primary-red btn-sm" style="margin-right:5px;" onclick="javascript:showEditDialog();">编辑</button>
			<button class="btn btn-primary-red btn-sm" style="margin-right:5px;" onclick="javascript:showViewDialog();">查看</button>
			<button class="btn btn-primary-red btn-sm" style="margin-right:7px;" onclick="javascript:del();">删除</button>
			<button class="btn btn-primary-red btn-sm pull-right" onclick="javascript:reset()">重置</button>
			<button class="btn btn-primary-red btn-sm pull-right" onclick="javascript:query()" style="margin-right:15px;">查询</button>
		</div>
	</div>

	<!-- 信息列表 -->
	<div class="row">
		<div class="col-xs-12">
			<div class="box box-info">
				<div class="box-body table-responsive no-padding">
					<table id="tbl_query" class="table table-hover"></table>
				</div>
			</div>
		</div>
	</div>

</section>
<!-- /.content -->

<!-- 详细信息 -->
<section id="sec_detail" class="content detail" style="display:none;">
	<div class="box box-info">
		<div class="box-body">
			<form id="frm_detail" class="form-horizontal" >
				<fieldset id='fld_detail'>
					<input name="id" type="hidden" value=""/>
					<div class="row">
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">id：</label>
									<div class="col-sm-8">
										<input name="id" class="form-control" placeholder="id" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">长约编号：</label>
									<div class="col-sm-8">
										<input name="arId" class="form-control" placeholder="长约编号" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">订单编号：</label>
									<div class="col-sm-8">
										<input name="ordrId" class="form-control" placeholder="订单编号" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">银行id：</label>
									<div class="col-sm-8">
										<input name="bnk" class="form-control" placeholder="银行id" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">银行名称：</label>
									<div class="col-sm-8">
										<input name="bnkNm" class="form-control" placeholder="银行名称" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">品名id：</label>
									<div class="col-sm-8">
										<input name="pdId" class="form-control" placeholder="品名id" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">品名：</label>
									<div class="col-sm-8">
										<input name="pdNm" class="form-control" placeholder="品名" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">规格：</label>
									<div class="col-sm-8">
										<input name="spec" class="form-control" placeholder="规格" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">质押指导价：</label>
									<div class="col-sm-8">
										<input name="plgDrcPrc" class="form-control" placeholder="质押指导价" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">操作员：</label>
									<div class="col-sm-8">
										<input name="username" class="form-control" placeholder="操作员" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">创建时间：</label>
									<div class="col-sm-8">
										<input name="crtTm" class="form-control" placeholder="创建时间" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">更新时间：</label>
									<div class="col-sm-8">
										<input name="udtTm" class="form-control" placeholder="更新时间" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">时间戳：</label>
									<div class="col-sm-8">
										<input name="tms" class="form-control" placeholder="时间戳" value="2" />
									</div>
								</div>
							</div>
													<div class="col-md-6" id="$column.comments_div">
								<div class="form-group">
									<label for="" class="col-sm-4 control-label">备注：</label>
									<div class="col-sm-8">
										<input name="rmrk" class="form-control" placeholder="备注" value="2" />
									</div>
								</div>
							</div>
											</div>
				</fieldset>
			</form>
		</div>
		<div class="box-footer">
			<button id="btn_save" type="button" class="btn btn-primary pull-right" onclick="javascript:save();">保存</button>
			<button id="btn_close" type="button" class="btn btn-default pull-right" onclick="javascript:hideDetail();" style="margin-right:15px;">返回</button>
		</div>
	</div>
</section>
<!-- /.content -->


<script th:src="@{/resources/plugins/jQuery/jquery-2.2.3.min.js}"></script>
<script th:src="@{/resources/plugins/bootbox/bootbox.min.js?v=1}"></script>
<script th:src="@{/resources/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/resources/plugins/bootstrapValidator/bootstrapValidator.min.js}"></script>
<script th:src="@{/resources/dist/js/app.min.js}"></script>
<script th:src="@{/resources/e7/e7util-0.2.js}"></script>
<script th:src="@{/resources/e7/e7table/e7table-0.2.js}"></script>
<script th:src="@{/resources/e7/e7crud-0.2.js}"></script>

<script type="text/javascript">
	var pageSetting = {
		modelName : '质押指导价',
		resetPath : '[[@{/plgDrcPrc}]]'
	};

	$(function(){
		//e7table表格控件初始化
		e7tableInit();
		//表单校验控件初始化
		validatorInit();
	});

	/***
	 * 查询
	 */
	function query() {
		$('#tbl_query').e7table('query','#frm_query');
	}

	/***
	 * 重置
	 */
	function reset() {
		E7.resetForm('#frm_query');
	}

	/***
	 * e7table表格控件初始化
	 */
	function e7tableInit() {
		$('#tbl_query').e7table({
			url : '[[@{/plgDrcPrc/queryPage}]]',
			pageSize: 10,
			sortName : 'tms', //排序列名,更新时间
			autoLoading: true,			//控件初始化后，自动远程请求数据
			selectType:'multiple',
			checkbox: true,
			columns : [
			    																			{title: '长约编号', field: 'arId', sortable: true},
																			{title: '订单编号', field: 'ordrId', sortable: true},
																			{title: '银行id', field: 'bnk', sortable: true},
																			{title: '银行名称', field: 'bnkNm', sortable: true},
																			{title: '品名id', field: 'pdId', sortable: true},
																			{title: '品名', field: 'pdNm', sortable: true},
																			{title: '规格', field: 'spec', sortable: true},
																			{title: '质押指导价', field: 'plgDrcPrc', sortable: true},
																			{title: '操作员', field: 'username', sortable: true},
																			{title: '创建时间', field: 'crtTm', sortable: true},
																			{title: '更新时间', field: 'udtTm', sortable: true},
																			{title: '时间戳', field: 'tms', sortable: true},
																			{title: '备注', field: 'rmrk', sortable: true},
												],
			onDblclick : function(index, row) {
				showViewDialog();
			}
		});
	}

	/***
	 * 表单校验控件初始化
	 */
	function validatorInit() {
		$('#frm_detail').bootstrapValidator({
			feedbackIcons: {
				valid: 'glyphicon glyphicon-ok',
				invalid: 'glyphicon glyphicon-remove',
				validating: 'glyphicon glyphicon-refresh'
			},
			fields: {

			}
		});

		$('#btn_save').click(function() {
			$('#frm_detail').bootstrapValidator('validate');
		});
	}

	/***
	 * 显示详情div
	 */
	function showDetail(title, editable){
		if(editable) {
			$('#fld_detail').prop('disabled', false);
			$('#btn_save').show();
		} else {
			$('#fld_detail').prop('disabled', true);
			$('#btn_save').hide();
		}

		$('#h3_detailTitle').text(title);
		$('#sec_detail').fadeIn(300);
		$('#sec_main').hide();
	}

	/***
	 * 隐藏详情div
	 */
	function hideDetail(){
		$('#sec_detail').fadeOut(300);
		setTimeout(function(){
			$('#sec_main').show();
		}, 300)
	}
	
	function showViewDialog() {
		var rows = $('#tbl_query').e7table('getSelectedRows');
		if (rows.length == 0) {
			bootbox.alert({
				'title' : '错误消息',
				'message' : '请选择数据！'
			});
			return;
		} else if (rows.length > 1) {
			bootbox.alert({
				'title' : '错误消息',
				'message' : '一次只能修改一条数据！'
			});
			return;
		}
		if ($('#frm_detail').data('bootstrapValidator')) {
			$('#frm_detail').data('bootstrapValidator').resetForm(true);
		}
		queryArDetails(rows[0]['id']);// flag 1:长约提交  0：长约详情查询
		showOrHideDetail(false, 3);
	}
	
	function queryArDetails(id){// type 1:长约提交  0：长约详情查询
			
		if ($('#frm_detail').data('bootstrapValidator')) {
			$('#frm_detail').data('bootstrapValidator').resetForm(true);
		}
		E7.post(pageSetting.resetPath + '/getDetailById', {
			'id' : id
		}, function(result) {
			fillForm('#frm_detail', result.data);
			var detail = result.data;
			for (key in detail) {
				$('#frm_detail [name="' + key + '"]').val(detail[key]);
			}

			// 长约详情div标题
			$('#main_edit_detail_title').text("长约信息");			
			
			// 决定显示哪一个返回按钮
			if(type == 1){
				// 返回到长约详情查询
				$('#btn_close_return4').show();
				$('#btn_close_return3').hide();	
			} else {
				// 返回到长约提交
				$('#btn_close_return3').show();
				$('#btn_close_return4').hide();	
			}
		});
	}	

	
	function showOrHideDetail(editable, flag) {
		if (editable) {
			$('#fld_detail').prop('disabled', false);
			$('#btn_save').show();
		} else {
			$('#fld_detail').prop('disabled', true);
			$('#btn_save').hide();
		}
		// 长约列表查询
		if(flag == 1){
			$('#main_search_detail').fadeIn(300);
			$('#main_edit_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').hide();
			$('#submit_ar_detail').hide();
			// 返回按钮
			$('#btn_close_div').hide();	
			$('#query_ar_submmit_detail').hide();
		} else if(flag == 2){// 长约发起	
			// section
			$('#main_edit_detail_title').text("长约发起");
			$('#main_edit_detail').fadeIn(300);
			$('#main_search_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').hide();
			$('#submit_ar_detail').hide();
			$('#query_ar_submmit_detail').hide();
			// 返回按钮
			$('#btn_close_div').hide();	
			// 提交详情页面的返回
			$('#submmit_btn_close_div').hide();
			// 附件
			$('#upload_ar_div').show();
			$('#query_ar_atch_div').hide();
			// 保险信息输入部门默认隐藏
			show_or_hide_ins_div(false);
			// 参数
			$('#arIdDiv').hide();
			// 按钮				
			$('#btn_close').show();
			$('#btn_save').show();
			//面板收缩控制
			var div = document.getElementById('main_edit_detail_clapse'); 
			div.setAttribute("class", "box box-info"); 
			//面板收缩+-号
			div = document.getElementById('main_edit_detail_li'); 
			div.setAttribute("class", "fa fa-minus"); 
		} else if(flag == 3){// 长约详情查看
			//$('#main_edit_detail_title').text("长约信息");
			// section
			// 保险信息输入部门显示隐藏
			show_or_hide_ins_div(true);
			$('#main_edit_detail').fadeIn(300);
			$('#main_search_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').fadeIn(300);
			$('#submit_ar_detail').hide();
			$('#query_ar_submmit_detail').hide();
			// 附件
			$('#upload_ar_div').hide();
//			$('#query_ar_atch_div').show();//改为在查询后控制显示，没有数据的不显示
			// 返回按钮
			$('#btn_close_div').show();
			// 提交详情页面的返回
			$('#submmit_btn_close_div').hide();
			// 参数
			$('#arIdDiv').show();
			// 按钮	
			$('#btn_close').hide();
			$('#btn_save').hide();
			$('#btn_save_submmit').hide();
			
			//面板收缩控制
			var div = document.getElementById('ar_lnk_jrnl_inf_detail_clapse_box'); 
			div.setAttribute("class", "box box-info");
			div = document.getElementById('main_edit_detail_clapse'); 
			div.setAttribute("class", "box box-info"); 
			//面板收缩+-号
			div = document.getElementById('main_edit_detail_li'); 
			div.setAttribute("class", "fa fa-minus"); 
		} else if(flag == 6){// 长约修改
			// section
			$('#main_edit_detail_title').text("长约修改");
			$('#main_edit_detail').fadeIn(300);
			$('#main_search_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').hide();
			$('#submit_ar_detail').hide();
			$('#query_ar_submmit_detail').hide();
			// 返回按钮
			$('#btn_close_div').hide();	
			// 提交详情页面的返回
			$('#submmit_btn_close_div').hide();
			// 附件
			$('#upload_ar_div').show();
			$('#query_ar_atch_div').hide();
			// 保险信息输入部门默认隐藏
			show_or_hide_ins_div(true);
			// 参数
			$('#arIdDiv').hide();
			// 按钮				
			$('#btn_close').show();
			$('#btn_save').show();
			//面板收缩控制
			var div = document.getElementById('main_edit_detail_clapse'); 
			div.setAttribute("class", "box box-info"); 
			//面板收缩+-号
			div = document.getElementById('main_edit_detail_li'); 
			div.setAttribute("class", "fa fa-minus"); 
		} else if(flag == 4){// 长约提交
			//$('#main_edit_detail_title').text("长约信息");
			// section
			$('#main_edit_detail').fadeIn(300);
			$('#main_search_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').fadeIn(300);
			$('#submit_ar_detail').fadeIn(300);
			$('#query_ar_submmit_detail').hide();
			// 附件
			$('#upload_ar_div').hide();
			$('#query_ar_atch_div').show();
			// 返回按钮
			$('#btn_close_div').hide();
			// 提交详情页面的返回
			$('#submmit_btn_close_div').hide();
			// 参数
			$('#arIdDiv').show();
			// 按钮
			$('#btn_close').hide();
			$('#btn_save').hide();
			//面板收缩控制
			var div = document.getElementById('ar_lnk_jrnl_inf_detail_clapse_box'); 
			div.setAttribute("class", "box box-info collapsed-box");
			div = document.getElementById('main_edit_detail_clapse'); 
			div.setAttribute("class", "box box-info collapsed-box"); 
			//面板收缩+-号
			div = document.getElementById('main_edit_detail_li'); 
			div.setAttribute("class", "fa fa-plus"); 
			div = document.getElementById('ar_lnk_jrnl_inf_detail_li'); 
			div.setAttribute("class", "fa fa-plus"); 
		} else if(flag == 5){//长约提交详情查看
			$('#main_search_detail').hide();
			$('#main_edit_detail').hide();
			$('#ar_lnk_jrnl_inf_detail').hide();
			$('#submit_ar_detail').hide();
			// 返回按钮
			$('#btn_close_div').hide();	
			$('#query_ar_submmit_detail').fadeIn(300);	
			// 提交详情页面的返回
			$('#submmit_btn_close_div').show();
		}
	}
</script>
</body>
</html>